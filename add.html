<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Add Song</title>

  <!--
    Page: add.html
    Purpose:
      - Provide a form so the user can enter a favorite song.
      - Save song data into Web Storage (localStorage).
      - After saving, send the user to the Songs page.
  -->

  <!-- jQuery + jQuery Mobile -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/mobile/1.5.0-alpha.1/jquery.mobile-1.5.0-alpha.1.min.css">
  <script src="https://code.jquery.com/mobile/1.5.0-alpha.1/jquery.mobile-1.5.0-alpha.1.min.js"></script>

  <!-- Use ThemeRoller theme files from ZIP -->
  <link rel="stylesheet" href="themes/lemonade.css">

  <script>
    // ------------------------------------------------------------
    // When the Add Song form is submitted:
    //   1. Read the form values.
    //   2. Get any existing songs from localStorage.
    //   3. Add the new song to that list.
    //   4. Save the updated list back to localStorage.
    //   5. Redirect the user to songs.html to view all favorites.
    // ------------------------------------------------------------
    $(document).on("submit", "#songForm", function (e) {
      e.preventDefault(); // Prevent normal form submit / page reload.

      // 1. Read values from the form fields.
      const song = {
        title:  $("#title").val().trim(),
        artist: $("#artist").val().trim(),
        genre:  $("#genre").val(),
        year:   $("#year").val().trim(),
        rating: $("#rating").val(),
        notes:  $("#notes").val().trim()
      };

      // 2. Get existing songs from localStorage (if any).
      let songs = [];
      const stored = localStorage.getItem("favoriteSongs");
      if (stored) {
        try {
          songs = JSON.parse(stored);
        } catch (e) {
          console.error("Could not parse favoriteSongs:", e);
        }
      }

      // 3. Add the new song object to the list.
      songs.push(song);

      // 4. Save the updated list back to localStorage.
      localStorage.setItem("favoriteSongs", JSON.stringify(songs));

      // 5. Redirect to the Songs page so the user can see the result.
      window.location.href = "songs.html";
    });
  </script>
</head>
<body>

<!--
  jQuery Mobile page for adding a new song.
-->
<div data-role="page" id="add-page">

  <!--
    Header:
      - Shows "Add Favorite Song".
      - Has an automatic back button (data-add-back-btn="true").
      - Back button goes to the previous page.
  -->
  <div data-role="header" data-add-back-btn="true" data-theme="c">
    <h1>Add Favorite Song</h1>
  </div>

  <!--
    Main content:
      - Form with fields for song data.
      - Save Song button to store data.
      - Back to List button to go back without saving.
  -->
  <div role="main" class="ui-content">
    <p>Enter the details of your favorite song and tap "Save Song".</p>

    <!--
      Form: songForm
      Fields:
        - Title (required)
        - Artist
        - Genre
        - Year
        - Rating
        - Notes
    -->
    <form id="songForm">
      <div class="ui-field-contain">
        <label for="title">Title:</label>
        <input type="text" name="title" id="title" required>
      </div>

      <div class="ui-field-contain">
        <label for="artist">Artist:</label>
        <input type="text" name="artist" id="artist">
      </div>

      <div class="ui-field-contain">
        <label for="genre">Genre:</label>
        <select name="genre" id="genre">
          <option value="">Select genre</option>
          <option value="Pop">Pop</option>
          <option value="Rock">Rock</option>
          <option value="Indie">Indie</option>
          <option value="Country">Country</option>
          <option value="Other">Other</option>
        </select>
      </div>

      <div class="ui-field-contain">
        <label for="year">Year:</label>
        <input type="number" name="year" id="year" min="1900" max="2100">
      </div>

      <div class="ui-field-contain">
        <label for="rating">Rating:</label>
        <select name="rating" id="rating">
          <option value="">No rating</option>
          <option value="1">1 - Meh</option>
          <option value="2">2</option>
          <option value="3">3 - Good</option>
          <option value="4">4</option>
          <option value="5">5 - Favorite</option>
        </select>
      </div>

      <div class="ui-field-contain">
        <label for="notes">Notes:</label>
        <textarea name="notes" id="notes"></textarea>
      </div>

      <!--
        Button: Save Song
        Action:
          - User submits the form.
        Result:
          - Song is saved to localStorage and user is taken to songs.html.
      -->
      <button type="submit" class="ui-btn ui-corner-all ui-shadow ui-btn-b">
        Save Song
      </button>
    </form>

    <!--
      Button: Back to List
      Action:
        - User click -> goes to songs.html without saving.
      Result:
        - User can view the list again; no new song is added.
    -->
    <a href="songs.html" class="ui-btn ui-corner-all ui-shadow" data-ajax="false">
      Back to List
    </a>
  </div>

  <!-- Footer -->
  <div data-role="footer" data-position="fixed" data-theme="c">
    <h4>Â© 2025 Favorite Songs Web App</h4>
  </div>
</div>

</body>
</html>
