<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Songs</title>

  <!--
    Page: songs.html
    Purpose:
      - Display a list of favorite songs.
      - Show some example songs.
      - Load and display saved songs from Web Storage (localStorage).
      - Provide navigation to Add Song and Home pages.
  -->

  <!-- jQuery + jQuery Mobile -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/mobile/1.5.0-alpha.1/jquery.mobile-1.5.0-alpha.1.min.css">
  <script src="https://code.jquery.com/mobile/1.5.0-alpha.1/jquery.mobile-1.5.0-alpha.1.min.js"></script>

  <!-- Use ThemeRoller theme files from ZIP -->
  <link rel="stylesheet" href="themes/lemonade.css">

  <script>
    // ------------------------------------------------------------
    // When the Songs page is shown, load favorite songs from
    // Web Storage (localStorage) and display them in the list.
    // ------------------------------------------------------------
    $(document).on("pageshow", "#songs-page", function () {
      const list = $("#songsList");

      // Clear only the dynamic items if needed (here we keep examples)
      // This is optional; we assume first few items are static examples.
      // Everything we add from JavaScript will use a class for clarity.
      list.find("li.dynamic-song").remove();

      // Get saved songs from localStorage
      const stored = localStorage.getItem("favoriteSongs");
      if (!stored) {
        return; // No saved songs yet; nothing to add.
      }

      let songs;
      try {
        songs = JSON.parse(stored);
      } catch (e) {
        console.error("Could not parse favoriteSongs:", e);
        return;
      }

      // Add each saved song as a new list item
      songs.forEach(function (song) {
        const title = song.title || "Untitled";
        const artist = song.artist || "";
        const extra = [];

        if (song.genre) extra.push(song.genre);
        if (song.year) extra.push(song.year);
        if (song.rating) extra.push("Rating: " + song.rating);
        if (song.notes) extra.push("Notes: " + song.notes);

        const line2 = extra.join(" • ");

        const li = $(`
          <li class="dynamic-song">
            <a href="#">
              <h2>${title}${artist ? " — " + artist : ""}</h2>
              ${line2 ? `<p>${line2}</p>` : ""}
            </a>
          </li>
        `);

        list.append(li);
      });

      // Refresh the listview so jQuery Mobile styles the new items
      list.listview("refresh");
    });
  </script>
</head>
<body>

<!--
  jQuery Mobile page that lists songs.
-->
<div data-role="page" id="songs-page">

  <!--
    Header:
      - Shows title "Favorite Songs".
      - Has an automatic back button (data-add-back-btn="true").
      - Back button returns to the previous page.
  -->
  <div data-role="header" data-add-back-btn="true" data-theme="b">
    <h1>Favorite Songs</h1>
  </div>

  <!--
    Main content:
      - Example songs.
      - Saved songs loaded from localStorage.
      - Buttons for navigation.
  -->
  <div role="main" class="ui-content">
    <p>Here are some example favorite songs and any songs you have saved.</p>

    <!--
      List of songs:
        - First items are examples.
        - Additional items are loaded from Web Storage and added with JS.
    -->
    <ul data-role="listview" data-inset="true" id="songsList">
      <!-- Example static song with star icon -->
      <li data-icon="star">
        <a href="#">
          <h2>Top Hit — "Everlong"</h2>
          <p>Foo Fighters</p>
        </a>
      </li>
      <li>
        <a href="#">
          <h2>"Levitating"</h2>
          <p>Dua Lipa</p>
        </a>
      </li>
      <li>
        <a href="#">
          <h2>"Dancing Queen"</h2>
          <p>ABBA</p>
        </a>
      </li>
      <!-- Dynamic songs from Web Storage will be appended here. -->
    </ul>

    <!--
      Button: Add a Song
      Action:
        - User click -> goes to add.html.
      Result:
        - Opens the Add Song form page.
    -->
    <a href="add.html" class="ui-btn ui-corner-all ui-shadow" data-ajax="false">
      Add a Song
    </a>

    <!--
      Button: Home
      Action:
        - User click -> goes to index.html.
      Result:
        - Returns to the main home page.
    -->
    <a href="index.html" class="ui-btn ui-corner-all ui-shadow" data-ajax="false">
      Home
    </a>
  </div>

  <!-- Footer -->
  <div data-role="footer" data-position="fixed" data-theme="b">
    <h4>© 2025 Favorite Songs Web App</h4>
  </div>
</div>

</body>
</html>
